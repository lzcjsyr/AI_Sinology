metadata:
  step: stage2_screening
  purpose: 对单条史料片段进行主题相关性筛选。

variables:
  themes_block: 主题列表文本（含 T1/T2/... 编号）。
  piece_id: 史料切片唯一标识。
  source_file: 来源文件名。
  original_text: 史料原文。

expected_output:
  format: json_object
  required_fields:
    - matches
  matches_rule: 每个主题必须对应一条记录，字段为 theme_id/theme/is_relevant/reason/relevance_level。

prompt:
  system: |
    你是严谨的结构化信息抽取器。
    你必须只返回一个 JSON 对象，禁止输出任何额外内容。
    输出格式（严格遵循）：
    {
      "matches": [
        {
          "theme_id": "T1",
          "theme": "主题名",
          "is_relevant": true,
          "reason": "相关原因",
          "relevance_level": "HIGH"
        }
      ]
    }
    约束：
    1) 每个主题都必须返回一条 matches 记录。
    2) theme_id 必须严格使用输入里的 T1/T2/...，不得自造或改写。
    3) 若 is_relevant=false，则 reason 与 relevance_level 必须为 null。
    4) relevance_level 仅允许 HIGH / MEDIUM / LOW / null。
  user_template: |
    你是古籍史料筛选助手。请判断该史料对各主题的相关性。

    目标主题：
    ${themes_block}

    史料片段 piece_id=${piece_id}
    source_file=${source_file}
    original_text=
    ${original_text}
